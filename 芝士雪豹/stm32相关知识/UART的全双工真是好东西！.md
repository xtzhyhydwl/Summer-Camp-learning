
>今天在学长指导下尝试了一个usb转ttl连接两个usart串口，一个连Rx只发送，另一个连Tx只接收，没想到成了！原来usart无论是发送only、接受only还是发and接，都是可以拆开用的！


# UART全双工验证无聊小工程

## 1. UART基本介绍

- 详见[[UART、USART|另一篇UART知识笔记]]

## 2. CubeMX配置

- 选USART1和USART2，都设置为rx&tx（其实没有必要，图省事），统一设置波特率9600
	![[Pasted image 20230810171539.png]]

- 找到u1的rx口、u2的tx口，以rx-tx的模式在面包板上和usb转ttl接好（此时每个串口的一对GPIO口中有一个没用，这是否有点浪费= _ =）

- 突发奇想加一个LED作为rx&tx标志，就这么干吧！（之后后悔了T_T）
	![[Pasted image 20230810171925.png]]

## 3. Keil代码

- 开机初始化先发送一个"welcome！"，LED闪烁，然后准备非阻塞式接收数据，放在while(1)中准备，诚意十足。
	![[Pasted image 20230810172936.png]]

- 中断回调函数如下，如果接收到特定数据则原样发送返回，同时接收计数+1，发送计数+1；如果非特定数据，则不发送，仅是接收计数+1。
	![[Pasted image 20230810173206.png]]

- 调试时可以通过查看count的得到发送接收次数（也许可以加入指令系统，指令获取数据……）

# 4. 遇到的问题

- 首先是面包板与开发板接触不良，一度让我怀疑杜邦线坏了，排查好久=  _  =

- 其次是遇到了技术性问题，我在中断回调函数中引用了HAL_Delay()函数，导致程序卡死。学长解释说因为==HAL_Delay()是最低级的中断，中断回调比它高级，所以delay一直进不去，导致卡死==……学到了

## 5. 总结

- 没啥，有点累

- 乐:P